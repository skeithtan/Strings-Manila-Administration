{"version":3,"sources":["../../../views/js/stock_inventory.js"],"names":["fetchStocks","completionHandler","client","query","then","StockInventory","props","state","products","lessThan","greaterThan","refreshState","bind","onLessThanInput","onGreaterThanInput","getFilteredProducts","refreshStockInventory","completion","result","sort","a","b","quantity","setState","undefined","event","target","value","filteredProducts","filter","product","loadingState","length","noProducts","Component","StockInventoryHead","refreshData","iziToast","success","title","message","timeout","progressBar","StockTable","rows","map","index","emptyState","fillOutRestockModal","$","val","id","html","name","hide","show","StockRow","rowClass","stall"],"mappings":"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","file":"stock_inventory.js","sourcesContent":["import React from 'react';\n\n//Fetch data\nfunction fetchStocks(completionHandler) {\n    client.query(`\n    {\n        products {\n            id\n            name\n            quantity\n            stall {\n                name\n            }\n        }\n    }\n    `).then(completionHandler);\n}\n\n//React\nclass StockInventory extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            products: null,\n            lessThan: null,\n            greaterThan: null,\n        };\n\n        this.refreshState = this.refreshState.bind(this);\n        this.onLessThanInput = this.onLessThanInput.bind(this);\n        this.onGreaterThanInput = this.onGreaterThanInput.bind(this);\n        this.getFilteredProducts = this.getFilteredProducts.bind(this);\n\n        refreshStockInventory = this.refreshState;\n        this.refreshState();\n    }\n\n    refreshState(completion) {\n        fetchStocks(result => {\n\n            // Lowest first\n            const products = result.products.sort((a, b) => {\n                return a.quantity > b.quantity\n            });\n\n            this.setState({\n                products: products\n            });\n\n            if (completion !== undefined) {\n                completion()\n            }\n        });\n    }\n\n    static noProducts() {\n        return (\n            <div className=\"container d-flex flex-column justify-content-center align-items-center h-100\">\n                <h3>There are no products yet.</h3>\n                <p className=\"text-faded\">When products are added, the inventory can be seen here.</p>\n            </div>\n        )\n    }\n\n    static loadingState() {\n        return (\n            <div>\n                <div className=\"container-fluid d-flex flex-column justify-content-center align-items-center h-100\">\n                    <h3>Loading...</h3>\n                </div>\n            </div>\n        );\n    }\n\n    onLessThanInput(event) {\n        const lessThan = event.target.value;\n        this.setState({\n            lessThan: event.target.value === \"\" ? null : lessThan\n        });\n    }\n\n    onGreaterThanInput(event) {\n        const greaterThan = event.target.value;\n        this.setState({\n            greaterThan: event.target.value === \"\" ? null : greaterThan\n        });\n    }\n\n    getFilteredProducts() {\n        const lessThan = this.state.lessThan;\n        const greaterThan = this.state.greaterThan;\n\n        let filteredProducts = this.state.products; //No filter yet\n\n        if (lessThan === null && greaterThan === null) {\n            return filteredProducts;\n        }\n\n        if (filteredProducts === null) {\n            return filteredProducts;\n        }\n\n        if (lessThan !== null) {\n            filteredProducts = filteredProducts.filter(product => {\n                return product.quantity < lessThan\n            })\n        }\n\n        if (greaterThan !== null) {\n            filteredProducts = filteredProducts.filter(product => {\n                return product.quantity > greaterThan\n            })\n        }\n\n        return filteredProducts;\n    }\n\n    render() {\n        if (this.state.products === null) {\n            return StockInventory.loadingState();\n        }\n\n        if (this.state.products.length === 0) {\n            return StockInventory.noProducts();\n        }\n\n        const filteredProducts = this.getFilteredProducts();\n\n        return (\n            <div id=\"stock-inventory\"\n                 className=\"container-fluid m-0 p-0 h-100 w-100 d-flex flex-column\">\n                <StockInventoryHead refreshState={this.refreshState}\n                                    onLessThanInput={this.onLessThanInput}\n                                    onGreaterThanInput={this.onGreaterThanInput}/>\n                <StockTable products={filteredProducts}/>\n            </div>\n        )\n    }\n}\n\nclass StockInventoryHead extends React.Component {\n    constructor(props) {\n        super(props);\n        this.refreshData = this.refreshData.bind(this);\n    }\n\n    refreshData() {\n        this.props.refreshState(\n            iziToast.success({\n                title: \"Refreshed\",\n                message: \"Data is up to date.\",\n                timeout: 1500,\n                progressBar: false\n            })\n        )\n    }\n\n    render() {\n        return (\n            <div id=\"stock-inventory-head\"\n                 className=\"container-fluid d-flex flex-row bg-light\">\n                <div className=\"mr-auto pt-5 row pl-3\">\n                    <h4 className=\"mr-3\">Inventory</h4>\n                    <div>\n                        <button className=\"btn btn-sm btn-outline-primary\"\n                                onClick={this.refreshData}>Refresh data\n                        </button>\n                    </div>\n                </div>\n                <div id=\"stock-filter\"\n                     className=\"row ml-auto mt-auto mb-2\">\n                    <div className=\"mt-auto mr-2\">\n                        <div className=\"mb-2 mb-sm-0\">\n                            <small className=\"text-muted mt-auto mb-2 mr-3 d-block\">Quantity filters</small>\n                            <div className=\"input-group\">\n                                <div className=\"input-group-addon\">Greater than</div>\n                                <input type=\"number\"\n                                       min=\"0\"\n                                       className=\"form-control\"\n                                       id=\"greater-than-filter\"\n                                       placeholder=\"No filter\"\n                                       onChange={this.props.onGreaterThanInput}/>\n                            </div>\n                        </div>\n                    </div>\n                    <div className=\"mt-auto mr-4\">\n                        <div className=\"input-group mb-2 mb-sm-0\">\n                            <div className=\"input-group-addon\">Less than</div>\n                            <input className=\"form-control\"\n                                   id=\"less-than-filter\"\n                                   type=\"number\"\n                                   min=\"0\"\n                                   placeholder=\"No filter\"\n                                   onChange={this.props.onLessThanInput}/>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        )\n    }\n}\n\nclass StockTable extends React.Component {\n    constructor(props) {\n        super(props);\n    }\n\n    static emptyState() {\n        return (\n            <div className=\"container-fluid d-flex flex-column align-items-center justify-content-center bg-light h-100\">\n                <h3>No results</h3>\n                <p className=\"text-faded\">Change your filter to try again</p>\n            </div>\n        )\n    }\n\n    render() {\n\n        const rows = this.props.products.map((product, index) => {\n            return <StockRow product={product}\n                             key={index}/>\n        });\n\n        if (rows.length === 0) {\n            return StockTable.emptyState();\n        }\n\n        return (\n            <div id=\"stocks-table\">\n                <table className=\"table table-hover\">\n                    <thead className=\"bg-light\">\n                    <tr>\n                        <th>Product Name</th>\n                        <th>Stall</th>\n                        <th>Quantity</th>\n                    </tr>\n                    </thead>\n                    <tbody>\n                    {rows}\n                    </tbody>\n\n                </table>\n            </div>\n        );\n    }\n}\n\nfunction fillOutRestockModal(product) {\n    $('#restock-product-id').val(product.id);\n    $('#restock-modal-product-name').html(product.name);\n    $('#restock-modal-product-quantity').html(product.quantity);\n\n    if (product.quantity === 0) {\n        $('#restock-button-group').hide();\n        $('#restock-dummy-button-group').show();\n    } else {\n        $('#restock-button-group').show();\n        $('#restock-dummy-button-group').hide();\n    }\n}\n\nclass StockRow extends React.Component {\n    constructor(props) {\n        super(props);\n    }\n\n    static rowClass(quantity) {\n        if (quantity === 0) {\n            return \"table-danger\"\n        }\n\n        if (quantity <= 20) {\n            return \"table-warning\";\n        }\n\n        return \"\";\n    }\n\n    render() {\n        return (\n            <tr className={StockRow.rowClass(this.props.product.quantity)}\n                data-toggle=\"modal\"\n                data-target=\"#restock-modal\"\n                onClick={() => {\n                    fillOutRestockModal(this.props.product)\n                }}>\n                <td>{this.props.product.name}</td>\n                <td>{this.props.product.stall.name}</td>\n                <td><b>{this.props.product.quantity}</b></td>\n            </tr>\n        );\n    }\n}\n\nexport default StockInventory;"]}