{"version":3,"sources":["../../../views/js/sales.js"],"names":["fetchSales","object","get","url","baseURL","beforeSend","data","startDate","endDate","success","completionHandler","error","console","log","response","Sales","props","dateToday","dateLastWeek","subtract","state","stalls","total_sales","total_quantity","dates","refreshState","bind","onDateChange","onRefreshButtonClick","toastID","formatDate","date","format","descending","stallA","stallB","sales","salesPerStalls","result","stall_sales","sort","setState","totalSales","totalQuantity","toast","document","getElementById","iziToast","hide","title","message","timeout","progressBar","toDate","dateString","info","id","Component","SalesHead","event","isStartDate","value","target","refreshData","SalesTable","rows","map","stall","loadingState","length","emptyState","SalesRow","name","quantity"],"mappings":"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","file":"sales.js","sourcesContent":["import React from 'react';\nimport $ from 'jquery';\nimport moment from 'moment';\nimport randomString from './random';\nimport {fillOutSalesModal, authorizeXHR} from \"./modals\";\n\n// Fetch data\nfunction fetchSales(object) {\n    $.get({\n        url: `${baseURL}/api/sales/`,\n        beforeSend: authorizeXHR,\n        data: {\n            \"start-date\": object.startDate,\n            \"end-date\": object.endDate\n        },\n        success: object.completionHandler,\n        error: response => console.log(response)\n    });\n}\n\n// React\nclass Sales extends React.Component {\n    constructor(props) {\n        super(props);\n\n        const dateToday = moment();\n        const dateLastWeek = moment().subtract(7, 'days');\n\n        this.state = {\n            stalls: null,\n            total_sales: null,\n            total_quantity: null,\n            dates: {\n                startDate: dateLastWeek,\n                endDate: dateToday,\n            }\n        };\n\n        this.refreshState = this.refreshState.bind(this);\n        this.onDateChange = this.onDateChange.bind(this);\n        this.onRefreshButtonClick = this.onRefreshButtonClick.bind(this);\n\n        this.refreshState();\n    }\n\n    refreshState(toastID = false) {\n        function formatDate(date) {\n            return date.format('YYYY-MM-DD');\n        }\n\n        const startDate = formatDate(this.state.dates.startDate);\n        const endDate = formatDate(this.state.dates.endDate);\n\n        fetchSales({\n            startDate: startDate,\n            endDate: endDate,\n            completionHandler: result => {\n                function descending(stallA, stallB) {\n                    return stallB.sales - stallA.sales;\n                }\n\n                const salesPerStalls = result.stall_sales.sort(descending);\n\n                this.setState({\n                    stalls: salesPerStalls,\n                    totalSales: result.total_sales,\n                    totalQuantity: result.total_quantity\n                });\n\n                if (toastID) {\n                    const toast = document.getElementById(toastID);\n                    iziToast.hide({}, toast);\n\n                    iziToast.success({\n                        title: \"Refreshed\",\n                        message: \"Data is up to date.\",\n                        timeout: 2500,\n                        progressBar: false\n                    })\n                }\n            }\n        })\n    }\n\n    onDateChange(dates) {\n        this.setState({\n            stalls: null,\n            total_sales: null,\n            total_quantity: null\n        });\n\n        function toDate(dateString) {\n            return moment(dateString, 'YYYY-MM-DD')\n        }\n\n        dates.startDate = toDate(dates.startDate);\n        dates.endDate = toDate(dates.endDate);\n        this.state.dates = dates;\n\n        this.refreshState();\n    }\n\n    onRefreshButtonClick() {\n        const toastID = randomString();\n        iziToast.info({\n            title: \"Fetching updates...\",\n            progressBar: false,\n            timeout: false,\n            id: toastID\n        });\n        this.refreshState(toastID);\n    }\n\n    render() {\n        return (\n            <div id=\"sales\"\n                 className=\"container-fluid m-0 p-0 h-100 w-100 d-flex flex-column\">\n                <SalesHead dates={this.state.dates}\n                           onDateChange={this.onDateChange}\n                           refreshData={this.onRefreshButtonClick}/>\n                <SalesTable stalls={this.state.stalls}\n                            totalQuantity={this.state.totalQuantity}\n                            totalSales={this.state.totalSales}/>\n            </div>\n        )\n    }\n}\n\nclass SalesHead extends React.Component {\n    constructor(props) {\n        super(props);\n        this.onDateChange = this.onDateChange.bind(this);\n    }\n\n    onDateChange(event, isStartDate) {\n        const value = moment(event.target.value);\n\n        if (isStartDate) {\n            this.props.onDateChange({\n                startDate: value,\n                endDate: this.props.dates.endDate,\n            })\n        } else {\n            this.props.onDateChange({\n                startDate: this.props.dates.startDate,\n                endDate: value\n            })\n        }\n    }\n\n    render() {\n        function formatDate(date) {\n            return date.format('YYYY-MM-DD');\n        }\n\n        const startDate = formatDate(this.props.dates.startDate);\n        const endDate = formatDate(this.props.dates.endDate);\n\n        return (\n            <div className=\"container-fluid row ml-auto mr-auto bg-light page-head\">\n                <div className=\"mr-auto row pt-5 pl-3 pr-3\">\n                    <h4 className=\"mr-3\">Sales</h4>\n                    <div>\n                        <button className=\"btn btn-sm btn-outline-primary mr-1\"\n                                onClick={this.props.refreshData}>Refresh Data\n                        </button>\n                        <button className=\"btn btn-sm btn-outline-primary\">Generate Report</button>\n                    </div>\n                </div>\n                <div className=\"row mb-2 ml-2 pt-3 mr-3\">\n                    <div className=\"mr-2\">\n                        <small className=\"text-muted mt-auto mb-2 mr-3 d-block\">Start Date</small>\n                        <input type=\"date\"\n                               className=\"form-control\"\n                               value={startDate}\n                               placeholder=\"Start Date\"\n                               onChange={event => this.onDateChange(event, true)}/>\n                    </div>\n                    <div className=\"mr-2\">\n                        <small className=\"text-muted mt-auto mb-2 mr-3 d-block\">End Date</small>\n                        <input type=\"date\"\n                               className=\"form-control\"\n                               value={endDate}\n                               placeholder=\"End Date\"\n                               onChange={event => this.onDateChange(event, false)}/>\n                    </div>\n                </div>\n            </div>\n        )\n    }\n}\n\nclass SalesTable extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.rows = this.rows.bind(this);\n    }\n\n    static loadingState() {\n        return (\n            <div className=\"container-fluid d-flex flex-column justify-content-center align-items-center h-100\">\n                <h3>Loading...</h3>\n            </div>\n        );\n    }\n\n    static emptyState() {\n        return (\n            <div className=\"container-fluid d-flex flex-column justify-content-center align-items-center h-100 bg-light\">\n                <h3>There's nothing here.</h3>\n                <p className=\"text-muted\">Refine your filters and try again.</p>\n            </div>\n        )\n    }\n\n    rows() {\n        return this.props.stalls.map(stall => <SalesRow key={stall.id}\n                                                        stall={stall}/>)\n    }\n\n    render() {\n\n        if (this.props.stalls === null) {\n            return SalesTable.loadingState();\n        }\n\n        if (this.props.stalls.length === 0) {\n            return SalesTable.emptyState();\n        }\n\n        return (\n            <div className=\"d-flex flex-column page-content\">\n                <table className=\"table table-hover page-table d-flex flex-column mb-0\">\n                    <thead className=\"thead-default\">\n                    <tr>\n                        <th>Stall Name</th>\n                        <th className=\"text-right\">Total Quantity Sold</th>\n                        <th className=\"text-right\">Total Sales</th>\n                    </tr>\n                    </thead>\n                    <tbody>\n                    {this.rows()}\n                    </tbody>\n                    <tfoot>\n                    <tr className=\"bg-light border\">\n                        <th>Total</th>\n                        <th className=\"financial-number\">{this.props.totalQuantity}</th>\n                        <th className=\"financial-number\">₱{this.props.totalSales}</th>\n                    </tr>\n                    </tfoot>\n                </table>\n            </div>\n        )\n    }\n}\n\nclass SalesRow extends React.Component {\n    constructor(props) {\n        super(props);\n    }\n\n    render() {\n        return (\n            <tr data-toggle=\"modal\"\n                data-target=\"#sales-modal\"\n                onClick={() => fillOutSalesModal(this.props.stall)}>\n                <td>{this.props.stall.name}</td>\n                <td className=\"financial-number\">{this.props.stall.quantity}</td>\n                <td className=\"financial-number\">₱{this.props.stall.sales}</td>\n            </tr>\n        )\n    }\n}\n\nexport default Sales;"]}