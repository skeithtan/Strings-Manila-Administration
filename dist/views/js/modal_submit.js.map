{"version":3,"sources":["../../../views/js/modal_submit.js"],"names":["refreshStalls","refreshProducts","randomString","replace","c","crypto","getRandomValues","Uint8Array","toString","$","click","onAddStallButtonClick","onRenameStallButtonClick","onDeleteStallButtonClick","on","val","onAddProductButtonClick","onModifyProductButtonClick","onDeleteProductButtonClick","stallName","ajax","url","baseURL","type","data","name","beforeSend","authorizeXHR","success","iziToast","title","message","error","console","log","response","stallNameInput","stallID","method","id","displayUploadingToast","info","timeout","hideUploadingToast","hide","document","getElementById","submitAddProduct","product","responseText","submitModifyProduct","productID","uploadImage","image","form","FormData","append","uploadToastID","post","async","contentType","processData","warning","xhr","setRequestHeader","imageInput","files","price","description","length","link","localStorage","token"],"mappings":"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","file":"modal_submit.js","sourcesContent":["var refreshStalls;\nvar refreshProducts;\n\nfunction randomString() {\n    // Random string with very little collision possibility\n    return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, c =>\n        (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)\n    )\n}\n\n$(() => {\n\n    //MARK: - Entity Management\n    //Stalls\n    $('#add-stall-button').click(onAddStallButtonClick);\n    $('#rename-stall-button').click(onRenameStallButtonClick);\n    $('#delete-stall-button').click(onDeleteStallButtonClick);\n    $('#add-stall-modal').on('hidden.bs.modal', () => {\n        $('#add-stall-name-input').val('');\n    });\n\n    //Products\n    $('#add-product-button').click(onAddProductButtonClick);\n    $('#modify-product-button').click(onModifyProductButtonClick);\n    $('#delete-product-button').click(onDeleteProductButtonClick);\n    $('#add-product-modal').on('hidden.bs.modal', () => {\n        $('#add-product-name-input').val('');\n        $('#add-product-price-input').val('');\n        $('#add-product-description-input').val('');\n        $('#add-product-image-input').val('');\n    });\n\n});\n\n//MARK: - Stalls\nfunction onAddStallButtonClick() {\n    const stallName = $('#add-stall-name-input').val();\n\n    $.ajax({\n        url: baseURL + 'stalls/',\n        type: 'POST',\n        data: {\n            name: stallName\n        },\n        beforeSend: authorizeXHR,\n        success: () => {\n            iziToast.success({\n                title: 'Added',\n                message: 'Successfully added stall.'\n            });\n\n            refreshStalls();\n        },\n        error: response => {\n            console.log(response);\n            iziToast.error({\n                title: 'Error',\n                message: 'Unable to add stall.'\n            })\n        },\n    });\n\n}\n\nfunction onRenameStallButtonClick() {\n    const stallNameInput = $('#rename-stall-name-input');\n    const stallName = stallNameInput.val();\n    const stallID = $('#rename-stall-id').val();\n    stallNameInput.val('');\n\n    $.ajax({\n        url: `${baseURL}stalls/${stallID}/`,\n        method: 'PUT',\n        data: {\n            name: stallName\n        },\n        beforeSend: authorizeXHR,\n        success: () => {\n            iziToast.success({\n                title: 'Renamed',\n                message: 'Successfully renamed stall.'\n            });\n\n            refreshStalls();\n        },\n        error: response => {\n            console.log(response);\n            iziToast.error({\n                title: 'Error',\n                id: 'uploading-image-toast',\n                message: 'Unable to rename stall.'\n            })\n        },\n    });\n}\n\nfunction onDeleteStallButtonClick() {\n    const stallID = $('#delete-stall-id').val();\n    $.ajax({\n        url: `${baseURL}stalls/${stallID}/`,\n        method: 'DELETE',\n        beforeSend: authorizeXHR,\n        success: () => {\n            iziToast.success({\n                title: 'Deleted',\n                message: 'Successfully deleted stall.'\n            });\n            refreshStalls();\n        },\n        error: response => {\n            console.log(response);\n            iziToast.error({\n                title: 'Error',\n                message: 'Could not delete stall.'\n            })\n        },\n    })\n}\n\n\n//MARK: - Products\nfunction displayUploadingToast() {\n    const id = randomString();\n    iziToast.info({\n        title: 'Uploading image...',\n        id: id,\n        timeout: false\n    });\n\n    return id;\n}\n\nfunction hideUploadingToast(id) {\n    iziToast.hide({}, document.getElementById(id));\n}\n\nfunction submitAddProduct(product, stallID) {\n    $.ajax({\n        url: `${baseURL}stalls/${stallID}/products/`,\n        method: 'POST',\n        data: product,\n        beforeSend: authorizeXHR,\n        success: () => {\n            iziToast.success({\n                title: 'Added',\n                message: 'Successfully added product'\n            });\n            refreshProducts();\n        },\n        error: response => {\n            console.log(response.responseText);\n            iziToast.error({\n                title: 'Error',\n                message: 'Unable to add product'\n            })\n        }\n    });\n}\n\nfunction submitModifyProduct(product, productID) {\n    $.ajax({\n        url: `${baseURL}products/${productID}/`,\n        method: 'PATCH',\n        data: product,\n        beforeSend: authorizeXHR,\n        success: () => {\n            iziToast.success({\n                title: 'Modified',\n                message: 'Successfully modified product'\n            });\n            refreshProducts();\n        },\n        error: response => {\n            console.log(response);\n            iziToast.error({\n                title: 'Error',\n                message: 'Unable to modify product'\n            });\n        }\n    })\n}\n\nfunction uploadImage(data) {\n    const image = data.image;\n    const form = new FormData();\n    form.append('image', image);\n\n    const uploadToastID = displayUploadingToast();\n    $.post({\n        url: 'https://api.imgur.com/3/image',\n        async: true,\n        data: form,\n        contentType: false,\n        processData: false,\n        success: response => {\n            hideUploadingToast(uploadToastID);\n            iziToast.success({\n                title: 'Uploaded',\n                message: 'Image has been uploaded.'\n            });\n            data.success(response);\n        },\n        error: response => {\n            hideUploadingToast(uploadToastID);\n            iziToast.warning({\n                title: 'Error',\n                message: 'Unable to upload photo. Using default photo instead.'\n            });\n            data.error(response);\n        },\n        beforeSend: xhr => {\n            xhr.setRequestHeader('Authorization', 'Client-ID 715b55f24db9cd2')\n        }\n    });\n\n}\n\nfunction onAddProductButtonClick() {\n    const imageInput = $('#add-product-image-input')[0].files;\n    const stallID = $('#add-product-stall-id').val();\n\n    let product = {\n        name: $('#add-product-name-input').val(),\n        price: $('#add-product-price-input').val(),\n        description: $('#add-product-description-input').val(),\n    };\n\n    if (imageInput.length) {\n        const image = imageInput[0];\n        uploadImage({\n            image: image,\n            success: response => {\n                product.image = response.data.link;\n                submitAddProduct(product, stallID)\n            },\n            error: response => {\n                console.log(response);\n                submitAddProduct(product, stallID);\n            }\n        })\n    } else {\n        submitAddProduct(product, stallID);\n    }\n}\n\nfunction onModifyProductButtonClick() {\n    const imageInput = $('#add-product-image-input')[0].files;\n    const productID = $('#modify-product-id').val();\n\n    let product = {\n        name: $('#modify-product-name-input').val(),\n        price: $('#modify-product-price-input').val(),\n        description: $('#modify-product-description-input').val()\n    };\n\n    if (imageInput.length) {\n        const image = imageInput[0];\n        uploadImage({\n            image: image,\n            success: response => {\n                product.image = response.data.link;\n                submitModifyProduct(product, productID);\n            },\n            error: response => {\n                console.log(response);\n                submitModifyProduct(product, productID);\n            }\n        })\n    } else {\n        submitModifyProduct(product, productID);\n    }\n}\n\nfunction onDeleteProductButtonClick() {\n    const productID = $('#delete-product-id').val();\n    $.ajax({\n        url: `${baseURL}products/${productID}/`,\n        method: 'DELETE',\n        beforeSend: authorizeXHR,\n        success: () => {\n            iziToast.success({\n                title: 'Deleted',\n                message: 'Successfully deleted product.'\n            });\n            refreshProducts();\n        },\n        error: response => {\n            console.log(response);\n            iziToast.error({\n                title: 'Error',\n                message: 'Could not delete product.'\n            })\n        }\n    })\n}\n\n//MARK: - XHR Authorization\nfunction authorizeXHR(xhr) {\n    xhr.setRequestHeader(\"Authorization\", \"Token \" + localStorage.token)\n}"]}